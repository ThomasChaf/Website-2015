<dom-module id="my-go-raytracer-page">

    <template>

        <h1>Go raytracer</h1>

        <section>
            <div class="base-container">

                <template is="dom-repeat" items="{{scene.triangles}}">
                    <my-triangle data={{item}}></my-triangle>
                </template>

                <template is="dom-repeat" items="{{scene.spheres}}">
                    <my-sphere data={{item}}></my-sphere>
                </template>

                <paper-button raised on-click="resolve">Submit</paper-button>

                <paper-button raised on-click="addSphere"><iron-icon icon="icons:add"></iron-icon>Sphere</paper-button>
                <paper-button raised on-click="addTriangle"><iron-icon icon="icons:add"></iron-icon>Triangle</paper-button>

            <div>
        </section>

        <section>

            <canvas id="mainCanvas" width="{{ scene.properties.Width }}" height="{{ scene.properties.Height }}"></canvas>

        </section>

    </template>

    <script src="/scripts/raytracer.js"></script>

    <script>

        Polymer({
            is: "my-go-raytracer-page",

            properties: {

                scene: {
                    type: Object,
                    value: {
                        properties: {
                            Width: 500,
                            Height:500
                        },
                        triangles: [],
                        spheres: []
                    }
                }

            },

            ready: function () {
                this.rt = Raytracer.create(this.$)
            },

            resolve: function() {
                for (var i = 0; i < this.scene.spheres.length; i++) {
                    this.scene.spheres[i].X = Number(this.scene.spheres[i].X)
                    this.scene.spheres[i].Y = Number(this.scene.spheres[i].Y)
                    this.scene.spheres[i].Z = Number(this.scene.spheres[i].Z)
                }
                for (var i = 0; i < this.scene.spheres.length; i++) {
                    this.scene.triangles.P1.X = Number(this.scene.triangles.P1.X)
                    this.scene.triangles.P2.Y = Number(this.scene.triangles.P2.Y)
                    this.scene.triangles.P3.Z = Number(this.scene.triangles.P3.Z)
                    this.scene.triangles.P1.X = Number(this.scene.triangles.P1.X)
                    this.scene.triangles.P2.Y = Number(this.scene.triangles.P2.Y)
                    this.scene.triangles.P3.Z = Number(this.scene.triangles.P3.Z)
                    this.scene.triangles.P1.X = Number(this.scene.triangles.P1.X)
                    this.scene.triangles.P2.Y = Number(this.scene.triangles.P2.Y)
                    this.scene.triangles.P3.Z = Number(this.scene.triangles.P3.Z)
                }
                this.rt.resolve(this.scene)
            },

            addTriangle: function() {
                this.push('scene.triangles', {
                    P1: [ 0, 0, 100 ],
                    P2: [0, -100, 0 ],
                    P3: [0, 100, 0 ],
                    Color: [255, 0, 0]
                });
            },

            addSphere: function() {
                this.push('scene.spheres', {
                    Size: 30,
                    X: 0, Y: 0, Z: 0,
                    Color: [255, 0, 0]
                });
            }
        });
    </script>

</dom-module>
